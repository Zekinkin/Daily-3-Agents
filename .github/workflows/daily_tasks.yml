name: ğŸ¤– æ¯æ—¥å†…å®¹é›†ä¸­ç”Ÿæˆ (æ™šé—´å¤‡ç¨¿)

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 21:00 = UTC 13:00
    # æ¯å¤©æ™šä¸Š 9 ç‚¹ï¼Œä¸€æ¬¡æ€§å¤‡å¥½æ˜å¤©çš„ä¸‰é¡¿é¥­
    - cron: '0 13 * * *'
  
  workflow_dispatch:
    inputs:
      task:
        description: 'æ‰‹åŠ¨æµ‹è¯•ä»»åŠ¡'
        required: true
        default: 'morning'
        type: choice
        options:
        - morning
        - afternoon
        - evening
        - all_daily

jobs:
  generate-all:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: pip install -r requirements.txt
      - run: echo '${{ secrets.SERVICE_ACCOUNT_JSON }}' > service_account.json
      
      - name: æ‰¹é‡ç”Ÿæˆå†…å®¹
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
          MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
          MAIL_RECIPIENTS: ${{ secrets.MAIL_RECIPIENTS }}
        run: |
          # å¦‚æœæ˜¯æ‰‹åŠ¨è§¦å‘ä¸”é€‰äº†ç‰¹å®šä»»åŠ¡
          if [ "${{ github.event_name }}" == "workflow_dispatch" ] && [ "${{ github.event.inputs.task }}" != "all_daily" ]; then
             python main.py --task ${{ github.event.inputs.task }}
          else
             # å®šæ—¶è§¦å‘ (æˆ–æ‰‹åŠ¨é€‰äº† all_daily)ï¼šè¿ç»­ç”Ÿæˆä¸‰ç¯‡
             echo "ğŸŒ™ å¼€å§‹ç”Ÿæˆæ˜æ—¥å†…å®¹..."
             
             echo "1ï¸âƒ£ ç”Ÿæˆæ—©æŠ¥..."
             python main.py --task morning
             
             echo "2ï¸âƒ£ ç”ŸæˆåˆæŠ¥..."
             python main.py --task afternoon
             
             echo "3ï¸âƒ£ ç”Ÿæˆæ™šæŠ¥..."
             python main.py --task evening
             
             echo "âœ… å…¨éƒ¨ç”Ÿæˆå®Œæ¯•ï¼è¯·æŸ¥æ”¶ 3 å°é¢„è§ˆé‚®ä»¶ã€‚"
          fi
