name: ğŸ¤– æ¯æ—¥å†…å®¹è‡ªåŠ¨ç”Ÿæˆ

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 08:00 (UTC 00:00) - æ—©æŠ¥
    - cron: '0 0 * * *'
    # åŒ—äº¬æ—¶é—´ 12:00 (UTC 04:00) - åˆæŠ¥
    - cron: '0 4 * * *'
    # åŒ—äº¬æ—¶é—´ 21:30 (UTC 13:30) - æ™šæŠ¥
    - cron: '30 13 * * *'
  workflow_dispatch:
    # å…è®¸æˆ‘ä»¬æ‰‹åŠ¨åœ¨ç½‘é¡µä¸Šç‚¹æŒ‰é’®è¿è¡Œæµ‹è¯•
    inputs:
      task:
        description: 'é€‰æ‹©è¿è¡Œä»»åŠ¡'
        required: true
        default: 'morning'
        type: choice
        options:
        - morning
        - afternoon
        - evening

jobs:
  run-ai-agent:
    runs-on: ubuntu-latest
    steps:
      - name: 1. æ‹‰å–ä»£ç 
        uses: actions/checkout@v3

      - name: 2. å®‰è£… Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 3. å®‰è£…ä¾èµ–åº“
        run: pip install -r requirements.txt

      - name: 4. æ¢å¤ Google å¯†é’¥æ–‡ä»¶
        # è¿™æ­¥å°±æ˜¯æŠŠ Secret å˜å›æ–‡ä»¶ä¾› sheets.py è¯»å–
        run: echo '${{ secrets.SERVICE_ACCOUNT_JSON }}' > service_account.json

      - name: 5. è¿è¡Œ Python è„šæœ¬
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          # å¦‚æœæ˜¯æ‰‹åŠ¨è§¦å‘ï¼ŒæŒ‰é€‰å®šçš„è·‘ï¼›å¦‚æœæ˜¯å®šæ—¶è§¦å‘ï¼ŒæŒ‰å½“å‰ UTC æ—¶é—´åˆ¤æ–­
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            python main.py --task ${{ github.event.inputs.task }}
          else
            HOUR=$(date +%H)
            if [ "$HOUR" == "00" ]; then python main.py --task morning; fi
            if [ "$HOUR" == "04" ]; then python main.py --task afternoon; fi
            if [ "$HOUR" == "13" ]; then python main.py --task evening; fi
          fi
